class Solution {
public:
    int maxProfit(vector<int>& prices, int fee) {
        int crt_max = prices[0], crt_min = prices[0], res = 0;
        for(int i = 1; i < prices.size(); i++){
            if(crt_max < prices[i]) crt_max = prices[i];
            if(prices[i] < crt_min || prices[i] < crt_max - fee){
                if(crt_max - crt_min > fee) res += crt_max - crt_min - fee;
                crt_max = prices[i];
                crt_min = prices[i];
            }
        }
        return res + max(0, crt_max - crt_min - fee);
    }
};
